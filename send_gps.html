<!doctype html>
<title>Bus GPS Sender</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<body>
  <h3>Bus GPS Sender</h3>
  <div id="log">Startingâ€¦</div>
  <script>
    // CHANGE THESE:
    const ENDPOINT = "http://192.168.1.35:5055/update_gps";  // e.g. http://192.168.1.20:5055
    const TOKEN    = "osnarayana";              // same as in app.py
    const FK_STUDENT_ID = "1";                             // users.id of the student to test

    function log(s){ document.getElementById('log').innerText = s; }

    async function send(lat, lon){
      const fd = new FormData();
      fd.append("fk_student_id", FK_STUDENT_ID);
      fd.append("lat", String(lat));
      fd.append("lon", String(lon));
      const res = await fetch(ENDPOINT, {
        method: "POST",
        headers: { "X-API-Token": TOKEN },
        body: fd
      });
      return res.json();
    }

    function tick(){
      if(!navigator.geolocation){ log("Geolocation not supported."); return; }
      navigator.geolocation.getCurrentPosition(async pos => {
        const {latitude, longitude} = pos.coords;
        try{
          const j = await send(latitude, longitude);
          log(`Sent: ${latitude.toFixed(5)}, ${longitude.toFixed(5)} | ok=${j.ok}`);
        }catch(e){ log("Send failed: " + e); }
      }, err => log("GPS error: " + err.message), { enableHighAccuracy:true, maximumAge:0, timeout:15000 });
    }

    // Send immediately, then every 10s
    tick();
    setInterval(tick, 10000);
  </script>
</body>
